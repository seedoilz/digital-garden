---
aliases: 
title: 数据仓库构建流程
date created: 2024-05-01 21:05:00
date modified: 2024-05-01 21:05:11
tags: [code/big-data, code/database]
---
![CleanShot 2024-05-01 at 21.40.01.png](https://typora-tes.oss-cn-shanghai.aliyuncs.com/picgo/CleanShot%202024-05-01%20at%2021.40.01.png)

## 流程
### 数据调研
数据调研重点要做两项工作，分别是业务调研和需求分析。这两项工作做的是否充分，直接影响着数据仓库的质量。
#### 业务调研
业务调研的主要目标是**熟悉业务流程、熟悉业务数据**。
**熟悉业务流程**要求做到，明确每个业务的具体流程，需要将该业务所包含的每个**业务过程**一一列举出来。
#### 需求分析
典型的需求指标如，最近一天各省份手机品类订单总额。
分析需求时，需要明确需求所需的**业务过程**及**维度**，例如该需求所需的业务过程就是买家下单，所需的维度有日期，省份，商品品类。

### 明确数据域
数据仓库模型设计除横向的分层外，通常也需要根据业务情况进行纵向划分数据域。
划分数据域的意义是**便于数据的管理和应用**。
通常可以根据业务过程或者部门进行划分，本项目根据业务过程进行划分，需要注意的是一个业务过程只能属于一个数据域。
下面是本数仓项目所需的所有业务过程及数据域划分详情。

| **数据域** | **业务过程**                  |
| ------- | ------------------------- |
| **交易域** | 加购、下单、取消订单、支付成功、退单、退款成功   |
| **流量域** | 页面浏览、启动应用、动作、曝光、错误        |
| **用户域** | 注册、登录                     |
| **互动域** | 收藏、评价                     |
| **工具域** | 优惠券领取、优惠券使用（下单）、优惠券使用（支付） |

### 构建业务总线矩阵
业务总线矩阵中包含维度模型所需的所有事实（业务过程）以及维度，以及各业务过程与各维度的关系。矩阵的行是一个个业务过程，矩阵的列是一个个的维度，行列的交点表示业务过程与维度的关系。
![CleanShot 2024-05-01 at 21.43.38.png](https://typora-tes.oss-cn-shanghai.aliyuncs.com/picgo/CleanShot%202024-05-01%20at%2021.43.38.png)
一个业务过程对应维度模型中一张事务型事实表，一个维度则对应维度模型中的一张维度表。**所以构建业务总线矩阵的过程就是设计维度模型的过程**。但是需要注意的是，总线矩阵中通常只包含事务型事实表，另外两种类型的事实表需单独设计。

按照事务型事实表的设计流程，**选择业务过程→声明粒度→确认维度→确认事实**，得到的最终的业务总线矩阵见以下表格。

### 明确统计指标
>明确统计指标具体的工作是，深入分析需求，构建指标体系。构建指标体系的主要意义就是指标定义标准化。所有指标的定义，都必须遵循同一套标准，这样能有效的避免指标定义存在歧义，指标定义重复等问题。
>
#### 指标体系相关概念
##### 原子指标
原子指标基于某一**业务过程**的**度量值**，是业务定义中不可再拆解的指标，原子指标的核心功能就是对指标的**聚合逻辑**进行了定义。我们可以得出结论，原子指标包含三要素，分别是业务过程、度量值和聚合逻辑。

例如**订单总额**就是一个典型的原子指标，其中的业务过程为用户下单、度量值为订单金额，聚合逻辑为sum()求和。需要注意的是原子指标只是用来辅助定义指标一个概念，通常不会对应有实际统计需求与之对应。

##### 派生指标
派生指标基于原子指标，其与原子指标的关系如下图所示。
![CleanShot 2024-05-01 at 21.45.43.png](https://typora-tes.oss-cn-shanghai.aliyuncs.com/picgo/CleanShot%202024-05-01%20at%2021.45.43.png)
与原子指标不同，派生指标通常会对应实际的统计需求。请从图中的例子中，体会指标定义标准化的含义。

##### 衍生指标
衍生指标是在一个或多个派生指标的基础上，通过各种逻辑运算复合而成的。例如比率、比例等类型的指标。衍生指标也会对应实际的统计需求。
![CleanShot 2024-05-01 at 21.46.20.png](https://typora-tes.oss-cn-shanghai.aliyuncs.com/picgo/CleanShot%202024-05-01%20at%2021.46.20.png)

#### 指标体系对于数仓建模的意义
通过上述两个具体的案例可以看出，绝大多数的统计需求，都可以使用原子指标、派生指标以及衍生指标这套标准去定义。同时能够发现这些统计需求都直接的或间接的对应一个或者是多个派生指标。

当统计需求足够多时，必然会出现部分统计需求对应的派生指标相同的情况。这种情况下，我们就可以考虑将这些公共的派生指标保存下来，这样做的主要目的就是减少重复计算，提高数据的复用性。

这些公共的派生指标统一保存在数据仓库的DWS层。因此DWS层设计，就可以参考我们根据现有的统计需求整理出的派生指标。