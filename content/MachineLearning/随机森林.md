---
aliases: [random forest]
date created: å››æœˆ 19æ—¥ 2023, 2:23:38 ä¸‹åˆ
date modified: ä¸‰æœˆ 5æ—¥ 2024, 4:07:12 ä¸‹åˆ
title: éšæœºæ£®æ—
tags: [code/machine-learning]
---

## åŸç†
æœ‰ N é¢—[[å†³ç­–æ ‘]]ï¼Œæ¯ä¸€é¢—å†³ç­–æ ‘åªä¸“æ³¨äºå¤„ç†æŸä¸€éƒ¨åˆ†æ•°æ®ï¼ˆä¹Ÿåªå…³æ³¨æŸä¸€éƒ¨åˆ†ç‰¹å¾ï¼‰ï¼Œæ¯ä¸€é¢—å†³ç­–æ ‘åœ¨å¤„ç†æŸäº›ç‰¹å¾æ—¶å€™çš„è¡¨ç°ä¼šæ¯”è¾ƒä¼˜è‰¯ï¼Œä»è€Œæ•´åˆæ‰€æœ‰å†³ç­–æ ‘çš„ç»“æœï¼Œæœ€åäº§ç”Ÿä¸€ä¸ªæ›´å¥½çš„ç»“æœã€‚

### æ ·æœ¬éšæœº
éšæœºé€‰å–éƒ¨åˆ†æ ·æœ¬è¿›è¡Œè®­ç»ƒğŸ‹ï¸ï¼Œèƒ½å¤Ÿä½¿å¾—å†³ç­–è¾¹ç•Œæ›´åŠ å¹³æ»‘å’Œå‡†ç¡®ã€‚

### ç‰¹å¾éšæœº
éšæœºé€‰å–éƒ¨åˆ†ç‰¹å¾è¿›è¡Œè®­ç»ƒğŸ‹ï¸ï¼Œå¼•å…¥éçº¿å½¢ï¼Œè®©å†³ç­–è¾¹ç•Œæ›´åŠ åˆç†ã€‚

## å®ä¾‹
### å¼•å…¥
```python
import numpy as np  
import scipy  
import pandas as pd  
from sklearn.ensemble import RandomForestClassifier  
from sklearn.tree import DecisionTreeClassifier  
from sklearn.model_selection import train_test_split, cross_val_score, GridSearchCV  
from sklearn.metrics import roc_curve, auc, roc_auc_score  
import matplotlib.pyplot as plt
```

### æ•°æ®å¤„ç†
ä¸ XGBoost ç±»ä¼¼ï¼Œéƒ½æ˜¯å°† X å’Œ Y è¿›è¡Œåˆ†ç¦»ï¼ŒX ä¸ºè¾“å…¥ï¼ŒY ä¸ºå®é™…è¦è¾“å‡ºçš„å†…å®¹ã€‚
```python
xtrain, xtest, ytrain, ytest = train_test_split(x, y, test_size=0.3, random_state=seed)
```

### å®é™…è®­ç»ƒ
```python
rfc = RandomForestClassifier(n_estimators=100, max_depth=10, min_samples_split=2, min_samples_leaf=1, random_state=42) #å®ä¾‹åŒ–

rfc = rfc.fit(xtrain,ytrain) #ç”¨è®­ç»ƒé›†æ•°æ®è®­ç»ƒæ¨¡å‹  
result = rfc.score(xtest,ytest) #å¯¼å…¥æµ‹è¯•é›†ï¼Œrfcçš„æ¥å£scoreè®¡ç®—çš„æ˜¯æ¨¡å‹å‡†ç¡®ç‡accuracy
```

### é‡è¦æ€§ç¨‹åº¦å¯è§†åŒ–
```python
importances = rfc.feature_importances_   #è·å–éšæœºæ£®æ—åˆ†ç±»å™¨ä¸­æ¯ä¸ªç‰¹å¾çš„é‡è¦æ€§å¾—åˆ†ï¼Œå­˜å‚¨åœ¨`importances`æ•°ç»„ä¸­ã€‚
std = np.std([tree.feature_importances_ for tree in rfc.estimators_], axis=0) #è®¡ç®—æ¯ä¸ªç‰¹å¾çš„é‡è¦æ€§å¾—åˆ†çš„æ ‡å‡†å·®ï¼Œè¿™ä¸ªæ ‡å‡†å·®å¯ä»¥åæ˜ ç‰¹å¾é‡è¦æ€§å¾—åˆ†çš„ç¨³å®šæ€§ã€‚è¿™é‡Œä½¿ç”¨äº†éšæœºæ£®æ—ä¸­æ¯æ£µæ ‘ä¸­ç‰¹å¾é‡è¦æ€§å¾—åˆ†çš„æ ‡å‡†å·®çš„å¹³å‡å€¼ä½œä¸ºç‰¹å¾é‡è¦æ€§å¾—åˆ†çš„æ ‡å‡†å·®ã€‚
indices = np.argsort(importances)[::-1] #è®¡ç®—æ¯ä¸ªç‰¹å¾çš„é‡è¦æ€§å¾—åˆ†çš„æ ‡å‡†å·®ï¼Œè¿™ä¸ªæ ‡å‡†å·®å¯ä»¥åæ˜ ç‰¹å¾é‡è¦æ€§å¾—åˆ†çš„ç¨³å®šæ€§ã€‚è¿™é‡Œä½¿ç”¨äº†éšæœºæ£®æ—ä¸­æ¯æ£µæ ‘ä¸­ç‰¹å¾é‡è¦æ€§å¾—åˆ†çš„æ ‡å‡†å·®çš„å¹³å‡å€¼ä½œä¸ºç‰¹å¾é‡è¦æ€§å¾—åˆ†çš„æ ‡å‡†å·®ã€‚
print("Feature ranking:")  
for f in range(min(20,xtrain.shape[1])):  
	print("%2d) %-*s %f" % (f + 1, 30, xtrain.columns[indices[f]], importances[indices[f]]))# Plot the feature importances of the forest  
plt.figure()  
plt.title("Feature importances")  
plt.bar(range(xtrain.shape[1]), importances[indices], color="r", yerr=std[indices], align="center")  
plt.xticks(range(xtrain.shape[1]), indices)  
plt.xlim([-1, xtrain.shape[1]])  
plt.show()
```